<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="board">

    <!-- 총 게시물 수를 반환하는 기능 -->
    <select id="totalCount" resultType="int" parameterType="String">
        SELECT COUNT(*) FROM board
        WHERE boardStatus = 0 AND boardType = #{bType}
    </select>

    <!--  원글들을 가져오는 기능 (status가 1이면 삭제된 글,
        정렬로 가장 최근의 글을 맨 위로 올라오게 해야 함!) -->
    <select id="list" resultType="mybatis.vo.BoardVO" parameterType="Map">
        SELECT * FROM(
        SELECT @RN:=@RN+1 AS rnum, a.* FROM(
        SELECT b.*, t.theaterName FROM board b
        JOIN theater t ON b.theaterIdx = t.theaterIdx
        WHERE b.boardStatus = 0 AND b.boardType = #{bType}
        ORDER BY b.boardIdx DESC
        ) a ) c, (SELECT @RN:=0) b
        WHERE c.rnum BETWEEN #{begin} AND #{end}
    </select>

    <!-- 저장 -->
    <insert id="add" parameterType="Map">
        INSERT INTO board(adminIdx, theaterIdx, boardType,
        boardTitle, boardContent, boardRegDate, boardExpDate)
        VALUES(#{adminIdx}, #{theaterIdx}, #{boardType},
        #{boardTitle}, #{boardContent}, NOW(), #{boardExpDate})
    </insert>

    <!-- 기본키를 인자로 받아서 원하는 게시물 검색 -->
    <select id="getBoard" parameterType="String" resultType="mybatis.vo.BoardVO">
        SELECT * FROM board
        WHERE boardIdx = #{idx} and boardStatus = 0
    </select>

    <!-- 이전글(현재 boardIdx보다 큰 값중에서 가장 작은 값)-->
    <select id="getPreviousBoard" parameterType="String" resultType="mybatis.vo.BoardVO">
        SELECT * FROM board
        WHERE boardIdx &gt; #{boardIdx}
        ORDER BY boardIdx ASC
        LIMIT 1;
    </select>

    <!-- 다음글(현재 boardIdx보다 작은 값중에서 가장 큰 값)-->
    <select id="getNextBoard" parameterType="String" resultType="mybatis.vo.BoardVO">
        SELECT * FROM board
        WHERE boardIdx &lt; #{boardIdx}
        ORDER BY boardIdx DESC
        LIMIT 1;
    </select>


</mapper>







<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="myInfo">

    <select id="getUser" parameterType="String" resultType="mybatis.vo.UserVO">
        select *
        from user
        where userId = #{s}
    </select>

    <select id="favorite" resultType="String" parameterType="String">
        SELECT
        t.theaterName
        FROM favoriteTheater f
        INNER JOIN theater t ON f.theaterIdx = t.theaterIdx
        WHERE f.userIdx = #{s}
    </select>
    <select id="reservation" parameterType="String" resultType="mybatis.vo.ReservationVO" >
        SELECT r.reservationIdx, r.theaterIdx, r.screenIdx, r.timetableIdx, r.reservationDate
        ,m.movieTitle, m.moviePosterUrl,
        h.theaterName,
        s.screenName,
        t.timetableStartTime
        FROM reservation r
        INNER JOIN timetable t ON r.timetableIdx = t.timetableIdx
        INNER JOIN movie m ON t.movieIdx = m.movieIdx
        inner join theater h on r.theaterIdx = h.theaterIdx
        inner join screen s on r.screenIdx=s.screenIdx
        WHERE r.userIdx = #{idx} AND r.reservationStatus = 0
    </select>

    <select id="getTotalPoint" parameterType="String" resultType="int">
        SELECT SUM(pointValue) AS totalPoints
        FROM point
        WHERE userIdx = #{idx}
        AND YEAR(pointDate) = YEAR(CURDATE()) and pointStatus=0 AND pointValue > 0
    </select>

</mapper>